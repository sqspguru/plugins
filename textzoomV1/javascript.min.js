document.addEventListener("DOMContentLoaded", ()=>{
  console.log("TextZoomer DOMContentLoaded triggered");

  const e = window.TextZoomerConfig || {};
  console.log("Loaded config:", e);

  let t = "html";
  if(e.scope === "blog") {
    if(!document.querySelector(".blog-item-wrapper")) {
      console.log("No blog wrapper found, exiting");
      return;
    }
    t = ".blog-basic-grid-item-wrapper .sqs-block-content";
  }
  console.log("Container selector:", t);

  function n(e,t){
    const n = new Date();
    n.setTime(n.getTime() + 24*60*60*1e3*t);
    document.cookie = `${e}=${t};path=/;expires=${n.toUTCString()}`;
    console.log("Cookie set:", e, t);
  }

  function o(e){
    const t = document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));
    return t ? t[2] : null;
  }

  let i = 100;
  if(e.useCookies){
    const t = o("fontZoom");
    if(t) {
      i = parseInt(t);
      console.log("Loaded zoom from cookie:", i);
    }
  } else {
    const t = localStorage.getItem("fontZoom");
    if(t) {
      i = parseInt(t);
      console.log("Loaded zoom from localStorage:", i);
    }
  }

  const r = e.position==="left-center" ? "tooltip-right" : "tooltip-left";
  const c = document.createElement("div");
  c.className = "fontzoom-controls "+(e.tooltips ? "tooltip-enabled" : "");
  c.style.cssText = {
    "left-center":"left:20px; top:50%; transform:translateY(-50%);",
    "right-center":"right:20px; top:50%; transform:translateY(-50%);",
    "bottom-right":"right:20px; bottom:20px;"
  }[e.position] || "left:20px; top:50%; transform:translateY(-50%);";

  const a = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 23" width="36" height="23">
      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2">
        <path stroke-linejoin="round" d="M26.58 21.32V1m-7.92 4.06V1H34.5v4.06"/>
        <path d="M22.62 21.32h7.92"/>
        <path stroke-linejoin="round" d="M6.78 18.61V5.06M1.5 7.77V5.06h10.56v2.71"/>
        <path d="M4.14 18.61h5.28"/>
      </g>
    </svg>`;

  c.innerHTML = `<button class="fz-toggle">${a}</button>
    <div class="fontzoom-buttons">
      <button class="${r}" data-tooltip="Zoom In" data-action="increase">A+</button>
      <button class="${r}" data-tooltip="Reset" data-action="reset">A</button>
      <button class="${r}" data-tooltip="Zoom Out" data-action="decrease">A-</button>
    </div>`;

  document.body.appendChild(c);
  console.log("Toolbar appended to body");

  function s(){
    document.querySelectorAll(t).forEach(el=>{
      el.style.fontSize = i + "%";
    });
    console.log("Applied zoom:", i);
    e.useCookies ? n("fontZoom", i, e.cookieDays) : localStorage.setItem("fontZoom", i);
  }

  s();

  c.addEventListener("click", e=>{
    const t = e.target.closest("button");
    if(!t) return;
    if(t.classList.contains("fz-toggle") && window.innerWidth <= 767){
      c.classList.toggle("expanded");
      console.log("Toolbar toggled (mobile)");
    } else {
      const action = t.dataset.action;
      if(action === "increase" && i < e.maxZoom) i += e.step;
      if(action === "decrease" && i > e.minZoom) i -= e.step;
      if(action === "reset") i = 100;
      console.log("Button clicked:", action, "New zoom:", i);
      s();
    }
  });
});
